{% extends "base.html" %}

{% block title %}–ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h4><i class="fas fa-users"></i> –ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤</h4>
            </div>
            <div class="card-body">
                <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
                <div class="row mb-3">
    <div class="col-md-6">
        <input type="text" class="form-control" id="global-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º (–§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω, –∞–¥—Ä–µ—Å)...">
    </div>
    <div class="col-md-6">
        <button class="btn btn-outline-secondary" onclick="clearAllFilters()">
            <i class="fas fa-times"></i> –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫
        </button>
        <a href="{{ url_for('main.add_client') }}" class="btn btn-primary ms-2">
            <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
        </a>
    </div>
</div>

                <!-- –¢–∞–±–ª–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
                <div class="table-responsive">
<!-- –ó–∞–º–µ–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã –≤ clients.html –Ω–∞ —ç—Ç–æ—Ç: -->

<table class="table table-striped table-hover" id="clients-table">
        <thead class="table-dark">
            <tr>
                <!-- –£–ë–†–ê–ù–´ –∫–æ–ª–æ–Ω–∫–∏: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –°—ä—ë–º–∫–∞ -->
                <th>–ù–∞—Å.–ø—É–Ω–∫—Ç</th>
                <th>–ê–¥—Ä–µ—Å</th>
                <th>–§–∞–º–∏–ª–∏—è</th>
                <th>–ò–º—è</th>
                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                <th>–£—Å–ª—É–≥–∞</th>
                <th>
                    <i class="fas fa-calendar-plus text-warning" title="–ü–æ —ç—Ç–æ–π –¥–∞—Ç–µ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞"></i>
                    –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏
                </th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for client in clients %}
            <tr>
                <!-- –£–ë–†–ê–ù–´ –∫–æ–ª–æ–Ω–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ -->
                <td>{{ client.address.city_info.city_name if client.address and client.address.city_info else '–ù–µ —É–∫–∞–∑–∞–Ω' }}</td>
                <td>{{ client.address.address if client.address else '–ù–µ —É–∫–∞–∑–∞–Ω' }}</td>
                <td>{{ client.sur_name }}</td>
                <td>{{ client.name }}</td>
                <td>{{ client.telefone or '' }}</td>
                <td>{{ client.service_name }}</td>
                <td>
                    <span class="text-primary fw-bold" title="–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏ (–ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –∏–∑ date_status)">
                        {{ client.created_at.strftime('%d.%m.%Y') if client.created_at else '–ù–µ —É–∫–∞–∑–∞–Ω–∞' }}
                    </span>
                </td>
                <td>
                    <div class="" role="group">
                        <button type="button" class="btn btn-sm btn-outline-success" 
                                onclick="openFolder({{ client.id }})" 
                                title="–û—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É">
                            <i class="fas fa-folder-open"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-primary" 
                                onclick="editClient({{ client.id }})" 
                                title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-danger" 
                                onclick="deleteClient({{ client.id }})" 
                                title="–£–¥–∞–ª–∏—Ç—å">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –§–æ—Ä–º–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è (—Å–∫—Ä—ã—Ç–∞—è) -->
<form id="delete-form" method="POST" style="display: none;">
    <input type="hidden" name="_method" value="DELETE">
</form>
{% endblock %}

{% block extra_js %}
<script>
console.log('–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è clients.html JavaScript');

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è tooltips –∫ –æ–±—Ä–µ–∑–∞–Ω–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É
function addTableTooltips() {
    const tableCells = document.querySelectorAll('#clients-table td');
    
    tableCells.forEach(cell => {
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç–æ–ª–±–µ—Ü —Å –∫–Ω–æ–ø–∫–∞–º–∏ –∏ –±–µ–π–¥–∂–∞–º–∏
        if (cell.querySelector('.btn-group') || cell.querySelector('.badge')) {
            return;
        }
        
        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç —è—á–µ–π–∫–∏
        const cellText = cell.textContent.trim();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ–±—Ä–µ–∑–∞–Ω –ª–∏ —Ç–µ–∫—Å—Ç
        if (cell.scrollWidth > cell.clientWidth && cellText.length > 0) {
            cell.setAttribute('title', cellText);
        }
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è tooltips –∫ –±–µ–π–¥–∂–∞–º —Å –¥–ª–∏–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
function addBadgeTooltips() {
    const badges = document.querySelectorAll('#clients-table .badge');
    
    badges.forEach(badge => {
        const badgeText = badge.textContent.trim();
        if (badgeText.length > 8) { // –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –¥–ª–∏–Ω–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤
            const parentCell = badge.closest('td');
            if (parentCell) {
                parentCell.setAttribute('title', badgeText);
                parentCell.classList.add('tooltip-instant'); // –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∫–∞–∑
            }
        }
    });
}

// –ü–ª–∞–≥–∏–Ω –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –µ–≤—Ä–æ–ø–µ–π—Å–∫–∏—Ö –¥–∞—Ç (–î–î.–ú–ú.–ì–ì–ì–ì)
jQuery.extend(jQuery.fn.dataTableExt.oSort, {
    "date-eu-pre": function (date) {
        if (!date || date === '' || date === '–ù–µ —É–∫–∞–∑–∞–Ω–∞') {
            return 0;
        }
        
        // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì
        var parts = date.split('.');
        if (parts.length !== 3) {
            return 0;
        }
        
        var day = parseInt(parts[0], 10);
        var month = parseInt(parts[1], 10) - 1; // –ú–µ—Å—è—Ü—ã –≤ JavaScript –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å 0
        var year = parseInt(parts[2], 10);
        
        // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç Date –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º timestamp –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        var dateObj = new Date(year, month, day);
        return dateObj.getTime();
    },

    "date-eu-asc": function (a, b) {
        return a - b;
    },

    "date-eu-desc": function (a, b) {
        return b - a;
    }
});

window.clientsTableInitialized = false;

function initializeClientTable() {
    if (typeof $ === 'undefined') {
        console.log('jQuery –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∂–¥–µ–º...');
        setTimeout(initializeClientTable, 100);
        return;
    }
    
    console.log('jQuery –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã...');
    
    try {
        const tableElement = $('#clients-table');
        
        if (tableElement.length === 0) {
            console.log('‚ùå –¢–∞–±–ª–∏—Ü–∞ #clients-table –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –ª–∏ —É–∂–µ —Ç–∞–±–ª–∏—Ü–∞
        if (window.clientsTableInitialized || $.fn.DataTable.isDataTable('#clients-table')) {
            console.log('‚ö†Ô∏è DataTable —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º...');
            
            if (window.clientsTable) {
                // –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–∞—Ç–∞ —Ç–µ–ø–µ—Ä—å –≤ –∫–æ–ª–æ–Ω–∫–µ 6 (–±—ã–ª–æ 8)
                window.clientsTable.order([[6, 'desc']]).draw(false);
                console.log('üîÑ –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü–µ');
            }
            return;
        }
        
        console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–æ–≤—É—é DataTable –±–µ–∑ –∫–æ–ª–æ–Ω–æ–∫ —Å—Ç–∞—Ç—É—Å–∞...');
        
        window.clientsTable = tableElement.DataTable({
            // –†—É—Å—Å–∫–∞—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
            "language": {
                "processing": "–ü–æ–¥–æ–∂–¥–∏—Ç–µ...",
                "search": "–ü–æ–∏—Å–∫:",
                "lengthMenu": "–ü–æ–∫–∞–∑–∞—Ç—å _MENU_ –∑–∞–ø–∏—Å–µ–π",
                "info": "–ó–∞–ø–∏—Å–∏ —Å _START_ –¥–æ _END_ –∏–∑ _TOTAL_ –∑–∞–ø–∏—Å–µ–π",
                "infoEmpty": "–ó–∞–ø–∏—Å–∏ —Å 0 –¥–æ 0 –∏–∑ 0 –∑–∞–ø–∏—Å–µ–π",
                "infoFiltered": "(–æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ –∏–∑ _MAX_ –∑–∞–ø–∏—Å–µ–π)",
                "infoPostFix": "",
                "loadingRecords": "–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–ø–∏—Å–µ–π...",
                "zeroRecords": "–ó–∞–ø–∏—Å–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.",
                "emptyTable": "–í —Ç–∞–±–ª–∏—Ü–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–µ",
                "paginate": {
                    "first": "–ü–µ—Ä–≤–∞—è",
                    "previous": "–ü—Ä–µ–¥—ã–¥—É—â–∞—è",
                    "next": "–°–ª–µ–¥—É—é—â–∞—è",
                    "last": "–ü–æ—Å–ª–µ–¥–Ω—è—è"
                },
                "aria": {
                    "sortAscending": ": –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ —Å—Ç–æ–ª–±—Ü–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é",
                    "sortDescending": ": –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ —Å—Ç–æ–ª–±—Ü–∞ –ø–æ —É–±—ã–≤–∞–Ω–∏—é"
                }
            },
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            "dom": '<"row"<"col-sm-6"l><"col-sm-6"f>>' +
                   '<"row"<"col-sm-12"tr>>' +
                   '<"row"<"col-sm-5"i><"col-sm-7"p>>',
            
            // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã
            "pageLength": 25,
            "order": [[6, "desc"]], // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–ø–µ—Ä—å –≤ –∫–æ–ª–æ–Ω–∫–µ 6 (–±—ã–ª–æ 8)
            "columnDefs": [
                { "orderable": false, "targets": 7 }, // –ö–æ–ª–æ–Ω–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π —Ç–µ–ø–µ—Ä—å 7 (–±—ã–ª–æ 9)
                { 
                    "targets": 6, // –ö–æ–ª–æ–Ω–∫–∞ —Å –¥–∞—Ç–æ–π —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–ø–µ—Ä—å 6 (–±—ã–ª–æ 8)
                    "type": "date-eu" // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—à –ø–ª–∞–≥–∏–Ω –¥–ª—è –µ–≤—Ä–æ–ø–µ–π—Å–∫–∏—Ö –¥–∞—Ç
                }
            ],
            
            // –í–∞—Ä–∏–∞–Ω—Ç—ã –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π
            "lengthMenu": [
                [10, 25, 50, 100, -1],
                ["10", "25", "50", "100", "–í—Å–µ"]
            ],
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            "searching": true,
            "lengthChange": true,
            "paging": true,
            "info": true,
            "autoWidth": false,
            "responsive": true,
            
            "drawCallback": function() {
                setTimeout(() => {
                    addTableTooltips();
                    addBadgeTooltips();
                }, 100);
            }
        });
        
        // –û—Ç–º–µ—á–∞–µ–º —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
        window.clientsTableInitialized = true;
        
        // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        setupTableEventHandlers();
        
        // –î–æ–±–∞–≤–ª—è–µ–º tooltips –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
        setTimeout(() => {
            addTableTooltips();
            addBadgeTooltips();
        }, 300);
        
        console.log('‚úÖ DataTable –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –±–µ–∑ –∫–æ–ª–æ–Ω–æ–∫ —Å—Ç–∞—Ç—É—Å–∞, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ (–∫–æ–ª–æ–Ω–∫–∞ 6)');
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ DataTable:', error);
        window.clientsTableInitialized = false;
    }
}

// –û—Ç–¥–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
function setupTableEventHandlers() {
    if (!window.clientsTable) {
        console.log('‚ö†Ô∏è –¢–∞–±–ª–∏—Ü–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏');
        return;
    }
    
    // –¢–æ–ª—å–∫–æ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ (—É–±—Ä–∞–Ω—ã —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ —Å—Ç–∞—Ç—É—Å—É –∏ —Ä–∞–±–æ—Ç–µ)
    $('#global-search').off('keyup').on('keyup', function() {
        window.clientsTable.search(this.value).draw();
    });
    
    console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (—Ç–æ–ª—å–∫–æ –ø–æ–∏—Å–∫)');
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –ø–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
function forceDateSort() {
    if (window.clientsTable && window.clientsTableInitialized) {
        console.log('üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ');
        window.clientsTable.order([[8, 'desc']]).draw(false);
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
function reinitializeTable() {
    console.log('üîÑ –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã...');
    
    if (window.clientsTable && $.fn.DataTable.isDataTable('#clients-table')) {
        window.clientsTable.destroy();
        console.log('üóëÔ∏è –°—Ç–∞—Ä–∞—è —Ç–∞–±–ª–∏—Ü–∞ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∞');
    }
    
    window.clientsTableInitialized = false;
    window.clientsTable = null;
    
    setTimeout(initializeClientTable, 100);
}

// –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —Ç–∞–±–ª–∏—Ü—ã...');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—ã–∑—ã–≤–∞–ª–∞—Å—å –ª–∏ —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    if (!window.clientsTableInitialized) {
        setTimeout(initializeClientTable, 200);
    } else {
        console.log('‚ÑπÔ∏è –¢–∞–±–ª–∏—Ü–∞ —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Ä–∞–Ω–µ–µ');
    }
});

// –ü—Ä–æ—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ jQuery
function openFolder(clientId) {
    const button = event.target.closest('button');
    if (!button) return;
    
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    button.disabled = true;
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º fetch –¥–ª—è AJAX –∑–∞–ø—Ä–æ—Å–∞ –≤–º–µ—Å—Ç–æ window.open
    fetch(`/client/${clientId}/open-folder`, {
        method: 'GET',
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
            showNotification('–ü–∞–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –≤ —Ñ–∞–π–ª–æ–≤–æ–º –º–µ–Ω–µ–¥–∂–µ—Ä–µ', 'success');
        } else {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–∞–ø–∫–∏', 'error');
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        showNotification('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–∞–ø–∫–∏', 'error');
    })
    .finally(() => {
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
        setTimeout(() => {
            button.innerHTML = originalText;
            button.disabled = false;
        }, 1000);
    });
}

function deleteClient(clientId) {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞?')) {
        const form = document.getElementById('delete-form');
        if (form) {
            form.action = `/client/${clientId}/delete`;
            form.submit();
        }
    }
}

function editClient(clientId) {
    window.location.href = `/client/${clientId}`;
}

function showReady() {
    if (window.clientsTable) {
        window.clientsTable.column(0).search('–ì–æ—Ç–æ–≤–∞').draw();
    }
}

function showProblematic() {
    if (window.clientsTable) {
        window.clientsTable.column(0).search('–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞').draw();
    }
}

function clearAllFilters() {
    const searchInput = document.getElementById('global-search');
    if (searchInput) {
        searchInput.value = '';
    }
    
    if (window.clientsTable) {
        window.clientsTable.search('').draw();
    }
    
    console.log('üßπ –ü–æ–∏—Å–∫ –æ—á–∏—â–µ–Ω');
}

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è tooltips –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —è—á–µ–π–∫–∞–º
function addCustomTooltip(selector, tooltipText) {
    const elements = document.querySelectorAll(selector);
    elements.forEach(element => {
        element.setAttribute('title', tooltipText);
        element.classList.add('tooltip-instant');
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö tooltips
function clearAllTooltips() {
    const elementsWithTitle = document.querySelectorAll('#clients-table [title]');
    elementsWithTitle.forEach(element => {
        element.removeAttribute('title');
        element.classList.remove('tooltip-instant', 'tooltip-dark', 'tooltip-gradient');
    });
}

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
window.tableTooltips = {
    add: addTableTooltips,
    addBadge: addBadgeTooltips,
    addCustom: addCustomTooltip,
    clear: clearAllTooltips
};

console.log('clients.html JavaScript –∑–∞–≥—Ä—É–∂–µ–Ω');
</script>
{% endblock %}