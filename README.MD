# Кадастровая База Данных - Веб-версия

Веб-приложение для управления кадастровой базой данных клиентов, созданное на Flask как замена десктопному PyQt5 приложению.

## Возможности

- ✅ Управление клиентами (добавление, редактирование, удаление)
- ✅ Управление городами
- ✅ Отслеживание статуса работ и съёмки
- ✅ Хранение паспортных данных
- ✅ Управление документооборотом
- ✅ Поиск и фильтрация клиентов
- ✅ Календарь работ
- ✅ Автоматическое создание папок для клиентов

## Установка и запуск

### 1. Клонирование репозитория
```bash
git clone <repository-url>
cd kadastr-web
```

### 2. Создание виртуального окружения
```bash
python -m venv venv

# Windows
venv\Scripts\activate

# Linux/Mac
source venv/bin/activate
```

### 3. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 4. Настройка переменных окружения
Создайте файл `.env` в корне проекта (уже существует) и при необходимости измените значения:

```env
# Flask настройки
FLASK_APP=run.py
FLASK_ENV=development
FLASK_DEBUG=True
FLASK_HOST=127.0.0.1
FLASK_PORT=5000

# База данных
DATABASE_URL=sqlite:///database/kadastr.db

# Безопасность
SECRET_KEY=your-secret-key-here

# Папки
WORK_FOLDER=./work_files
DOCS_FOLDER=./docs
```

### 5. Инициализация базы данных
```bash
# Создание таблиц и добавление базовых данных
python run.py

# Или используйте CLI команды Flask
flask init-db
flask seed-db
```

### 6. Запуск приложения
```bash
python run.py
```

Приложение будет доступно по адресу: http://127.0.0.1:5000

## CLI Команды

Приложение поддерживает следующие команды:

```bash
# Инициализация базы данных
flask init-db

# Заполнение базовыми данными (города)
flask seed-db

# Полный сброс базы данных
flask reset-db

# Показать все города
flask show-cities
```

## Структура проекта

```
kadastr-web/
├── app/                    # Основное приложение Flask
│   ├── __init__.py        # Фабрика приложений
│   ├── models.py          # Модели SQLAlchemy
│   ├── routes.py          # Маршруты Flask
│   ├── forms.py           # Формы WTF
│   └── templates/         # HTML шаблоны
│       ├── base.html      # Базовый шаблон
│       ├── clients.html   # Список клиентов
│       ├── add_client.html # Добавление клиента
│       └── edit_client.html # Редактирование клиента
├── database/              # База данных SQLite
├── work_files/           # Рабочие файлы клиентов
├── docs/                 # Шаблоны документов
├── config.py             # Конфигурация Flask
├── commands.py           # CLI команды
├── run.py                # Точка входа
├── requirements.txt      # Зависимости Python
└── .env                  # Переменные окружения
```

## Миграция с PyQt5

Если у вас есть данные из старого PyQt5 приложения:

1. Экспортируйте данные из SQLite базы старого приложения
2. Адаптируйте структуру данных под новые модели
3. Импортируйте данные используя Flask shell:

```bash
flask shell
>>> from app.models import *
>>> # Ваш код импорта данных
```

## Разработка

### Добавление новых маршрутов
Добавляйте новые маршруты в `app/routes.py`

### Изменение моделей данных
1. Измените модели в `app/models.py`
2. Создайте миграцию: `flask db migrate -m "описание изменений"`
3. Примените миграцию: `flask db upgrade`

### Стили и JavaScript
- Используется Bootstrap 5 и Font Awesome
- DataTables для работы с таблицами
- Дополнительные стили в `templates/base.html`

## Производственное развертывание

Для развертывания в production:

1. Установите `FLASK_ENV=production` в `.env`
2. Измените `SECRET_KEY` на безопасный случайный ключ
3. Используйте PostgreSQL или MySQL вместо SQLite
4. Настройте веб-сервер (Nginx + Gunicorn)

## Лицензия

[Укажите вашу лицензию]

## Поддержка

Для вопросов и предложений создавайте issues в репозитории.